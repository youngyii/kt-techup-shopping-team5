# ì¼€í´ì¼€í´ ì‡¼í•‘ëª° - ëª¨ë†€ë¦¬ì‹ ì„œë²„ ì•„í‚¤í…ì²˜

## ğŸ“‹ ëª©ì°¨
1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì „ì²´ ì•„í‚¤í…ì²˜](#ì „ì²´-ì•„í‚¤í…ì²˜)
3. [ì™¸ë¶€ ì‹œìŠ¤í…œ í†µí•©](#ì™¸ë¶€-ì‹œìŠ¤í…œ-í†µí•©)
4. [AI ê¸°ëŠ¥ ì•„í‚¤í…ì²˜](#ai-ê¸°ëŠ¥-ì•„í‚¤í…ì²˜)
5. [ê³„ì¸µ êµ¬ì¡°](#ê³„ì¸µ-êµ¬ì¡°)
6. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
7. [ì£¼ìš” ê¸°ëŠ¥ë³„ ì•„í‚¤í…ì²˜](#ì£¼ìš”-ê¸°ëŠ¥ë³„-ì•„í‚¤í…ì²˜)

---

## ì‹œìŠ¤í…œ ê°œìš”

**ì¼€í´ë²…ìŠ¤ ì‡¼í•‘ëª°**ì€ Spring Boot ê¸°ë°˜ì˜ ëª¨ë†€ë¦¬ì‹ E-Commerce í”Œë«í¼ìœ¼ë¡œ, **AI ê¸°ëŠ¥**ì„ í™œìš©í•œ ê°œì¸í™”ëœ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ
- **Backend**: Spring Boot 3.5.7, Java 21
- **Database**: MySQL 8.0
- **Cache**: Redis (Redisson ë¶„ì‚° ë½)
- **AI**: OpenAI GPT-4o-mini, Qdrant Vector Store
- **Storage**: AWS S3 / LocalStack
- **Monitoring**: ELK Stack (Elasticsearch, Logstash, Kibana)
- **Notification**: Slack API

---

## ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Client Layer                             â”‚
â”‚                    (Web Browser / Mobile)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP/HTTPS
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Spring Boot Application                       â”‚
â”‚                         (Port 8080)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Controller Layer (REST API)                   â”‚  â”‚
â”‚  â”‚  â€¢ ProductController  â€¢ OrderController  â€¢ ReviewControllerâ”‚  â”‚
â”‚  â”‚  â€¢ ChatbotController  â€¢ QuestionController                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Service Layer (Business Logic)                â”‚  â”‚
â”‚  â”‚  â€¢ ProductService     â€¢ OrderService     â€¢ ReviewService   â”‚  â”‚
â”‚  â”‚  â€¢ ChatbotService     â€¢ QuestionService  â€¢ PointService    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            Repository Layer (Data Access)                  â”‚  â”‚
â”‚  â”‚  â€¢ ProductRepository  â€¢ OrderRepository  â€¢ ReviewRepositoryâ”‚  â”‚
â”‚  â”‚  â€¢ Spring Data JPA    â€¢ QueryDSL (ë™ì  ì¿¼ë¦¬)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚                      â”‚
    â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL  â”‚          â”‚  Redis   â”‚          â”‚   S3     â”‚
â”‚  (Main  â”‚          â”‚ (Cache & â”‚          â”‚ (Image   â”‚
â”‚   DB)   â”‚          â”‚   Lock)  â”‚          â”‚ Storage) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚                      â”‚
    â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OpenAI  â”‚          â”‚  Qdrant  â”‚          â”‚  Slack   â”‚
â”‚   API   â”‚          â”‚ (Vector  â”‚          â”‚  (ì•Œë¦¼)   â”‚
â”‚ (AI)    â”‚          â”‚  Store)  â”‚          â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         ELK Stack (Logging)        â”‚
         â”‚  Elasticsearch â† Logstash â† App    â”‚
         â”‚         â†“                          â”‚
         â”‚       Kibana (Visualization)       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì™¸ë¶€ ì‹œìŠ¤í…œ í†µí•©

### 1. OpenAI API (AI ê¸°ëŠ¥)

**ì—­í• **: AI ê¸°ë°˜ ì¶”ì²œ, ì±—ë´‡, ë¦¬ë·° ìš”ì•½, ìƒí’ˆ ë¶„ì„

**í†µì‹  ë°©ì‹**: HTTPS REST API

**ì—°ë™ ì§€ì **:
```java
// Spring AIë¥¼ í†µí•œ OpenAI ì—°ë™
spring.ai.openai.api-key: sk-proj-...
spring.ai.openai.chat.options.model: gpt-4o-mini
spring.ai.openai.chat.options.temperature: 0.7
```

**ì‚¬ìš© ê¸°ëŠ¥**:
1. **AI ì±—ë´‡** (`ChatbotService`)
   - ì‚¬ìš©ì ì§ˆë¬¸ â†’ OpenAI ChatCompletion API
   - ì£¼ë¬¸ ë‚´ì—­ ì»¨í…ìŠ¤íŠ¸ ìë™ ì£¼ì…

2. **ìƒí’ˆ AI ë¶„ì„** (`ProductService`)
   - ìƒí’ˆ ìƒì„± ì‹œ íƒ€ê²Ÿ ì„±ë³„/ì—°ë ¹/ì¶”ì²œ ì´ìœ  ë¶„ì„
   - `ProductAnalysis` ì—”í‹°í‹°ì— ì €ì¥

3. **ë¦¬ë·° AI ìš”ì•½** (`ReviewSummaryService`)
   - ìµœê·¼ 30ê°œ ë¦¬ë·° â†’ ìš”ì•½ë¬¸ ìƒì„±
   - Redis ìºì‹± (24ì‹œê°„)

4. **AI ìƒí’ˆ ì¶”ì²œ** (`ProductService.recommendProducts()`)
   - ì‚¬ìš©ì ì§ˆë¬¸ â†’ ì„ë² ë”© â†’ ë²¡í„° ê²€ìƒ‰ â†’ OpenAI ì¶”ì²œ

**ì¬ì‹œë„ ì •ì±…**:
```yaml
spring.ai.retry:
  max-attempts: 4
  backoff:
    initial-interval: 1s
    multiplier: 2
    max-interval: 10s
```

---

### 2. Qdrant Vector Store (ë²¡í„° ê²€ìƒ‰)

**ì—­í• **: ìƒí’ˆ ì„ë² ë”© ì €ì¥ ë° ìœ ì‚¬ë„ ê²€ìƒ‰

**í†µì‹  ë°©ì‹**: gRPC (í¬íŠ¸ 6334)

**ì—°ë™ ì§€ì **:
```yaml
spring.ai.vectorstore.qdrant:
  host: localhost
  port: 6334
  collection-name: product_recommendations
  initialize-schema: true
```

**ë°ì´í„° íë¦„**:
```
1. ìƒí’ˆ ìƒì„± ì‹œ:
   ìƒí’ˆ ì •ë³´ â†’ OpenAI Embedding API â†’ ë²¡í„° ìƒì„± â†’ Qdrant ì €ì¥

2. AI ì¶”ì²œ ì‹œ:
   ì‚¬ìš©ì ì§ˆë¬¸ â†’ OpenAI Embedding API â†’ ë²¡í„° ìƒì„±
   â†’ Qdrant ìœ ì‚¬ë„ ê²€ìƒ‰ â†’ ìœ ì‚¬ ìƒí’ˆ ë°˜í™˜
   â†’ OpenAIë¡œ ì¶”ì²œ ì´ìœ  ìƒì„±
```

**ì €ì¥ ë°ì´í„° êµ¬ì¡°**:
```json
{
  "id": "product-123",
  "vector": [0.123, 0.456, ...],  // 1536ì°¨ì› ë²¡í„°
  "metadata": {
    "productId": 123,
    "name": "ë…¸íŠ¸ë¶",
    "description": "ê³ ì„±ëŠ¥ ê²Œì´ë° ë…¸íŠ¸ë¶",
    "price": 1500000
  }
}
```

---

### 3. AWS S3 / LocalStack (íŒŒì¼ ì €ì¥)

**ì—­í• **: ìƒí’ˆ ì´ë¯¸ì§€, ë¦¬ë·° ì´ë¯¸ì§€ ì €ì¥

**í†µì‹  ë°©ì‹**: AWS SDK (HTTPS)

**í™˜ê²½ë³„ ì„¤ì •**:
```yaml
# ë¡œì»¬ í™˜ê²½ (LocalStack)
spring.cloud.aws:
  s3:
    endpoint: http://localhost:4566
    path-style-access-enabled: true
  credentials:
    access-key: test
    secret-key: test

s3.bucket: kt-techup-shopping-local-media

# ìš´ì˜ í™˜ê²½ (AWS S3)
# endpoint ë¯¸ì§€ì • â†’ ì‹¤ì œ S3 ì‚¬ìš©
s3.bucket: kt-techup-shopping-prod-media
```

**íŒŒì¼ ì—…ë¡œë“œ íë¦„**:
```
1. í´ë¼ì´ì–¸íŠ¸ â†’ MultipartFile ì—…ë¡œë“œ
2. AwsS3Service.uploadFile()
   - UUID íŒŒì¼ëª… ìƒì„±
   - S3/LocalStack ì—…ë¡œë“œ
   - Public URL ë°˜í™˜
3. URLì„ Product.thumbnailImgUrlì— ì €ì¥
```

---

### 4. Redis (ìºì‹± & ë¶„ì‚° ë½)

**ì—­í• **:
- ì¡°íšŒìˆ˜ ìºì‹± (ì„±ëŠ¥ ìµœì í™”)
- ë¶„ì‚° ë½ (ë™ì‹œì„± ì œì–´)

**í†µì‹  ë°©ì‹**: Redis Cluster (í¬íŠ¸ 6379)

**ì—°ë™ ì§€ì **:
```yaml
spring.data.redis:
  ssl.enabled: false
  cluster:
    nodes: localhost:6379
    max-redirects: 3
```

**ì‚¬ìš© ì¼€ì´ìŠ¤**:

**1. ì¡°íšŒìˆ˜ ìºì‹±**:
```java
// ìƒí’ˆ ì¡°íšŒìˆ˜ ì¦ê°€
redisService.incrementViewCount("product:" + productId);

// ë§¤ì‹œê°„ Redis â†’ MySQL ë™ê¸°í™” (ViewSyncScheduler)
@Scheduled(cron = "0 0 * * * *")  // ë§¤ì‹œê°„
public void syncViewCounts() {
    Map<String, Long> viewCounts = redisService.getViewCounts();
    // MySQL ì—…ë°ì´íŠ¸
}
```

**2. ë¶„ì‚° ë½** (ì¬ê³  ì°¨ê°, í¬ì¸íŠ¸ ì ë¦½):
```java
@Lock(key = "#command.productId()", leaseTime = 3000L)
public void decreaseStock(StockDecreaseCommand command) {
    // ì¬ê³  ì°¨ê° ë¡œì§ (ë™ì‹œì„± ì•ˆì „)
}
```

---

### 5. MySQL (ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤)

**ì—­í• **: ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„° ì €ì¥

**í†µì‹  ë°©ì‹**: JDBC (í¬íŠ¸ 3306)

**ì£¼ìš” í…Œì´ë¸”**:
```
users            - ì‚¬ìš©ì
products         - ìƒí’ˆ
orders           - ì£¼ë¬¸
order_product    - ì£¼ë¬¸-ìƒí’ˆ ë§¤í•‘
payments         - ê²°ì œ
reviews          - ë¦¬ë·°
review_summaries - AI ë¦¬ë·° ìš”ì•½
questions        - Q&A ì§ˆë¬¸
answers          - Q&A ë‹µë³€
points           - í¬ì¸íŠ¸
cart_items       - ì¥ë°”êµ¬ë‹ˆ
wishlists        - ìœ„ì‹œë¦¬ìŠ¤íŠ¸
addresses        - ë°°ì†¡ì§€
```

**JPA ì„¤ì •**:
```yaml
spring.jpa:
  hibernate:
    ddl-auto: update
  properties:
    hibernate:
      dialect: org.hibernate.dialect.MySQLDialect
      show_sql: true
```

---

### 6. Slack (ì•Œë¦¼)

**ì—­í• **: ì£¼ìš” ì´ë²¤íŠ¸ ì•Œë¦¼ (ì£¼ë¬¸, ê²°ì œ, í™˜ë¶ˆ, ì—ëŸ¬)

**í†µì‹  ë°©ì‹**: Slack API (HTTPS)

**í™˜ê²½ë³„ ë¶„ë¦¬**:
```java
@Profile("local")
public class LocalNotifyApi implements NotifyApi {
    // ë¡œì»¬: ë¡œê·¸ë¡œë§Œ ì¶œë ¥
    public void notify(String message) {
        log.info(message);
    }
}

@Profile("prod")
public class DefaultNotifyApi implements NotifyApi {
    // ìš´ì˜: ì‹¤ì œ Slack ì „ì†¡
    public void notify(String message) {
        slackClient.chat().postMessage(req -> req
            .channel(logChannel)
            .text(message));
    }
}
```

**ì•Œë¦¼ ì´ë²¤íŠ¸**:
- ì£¼ë¬¸ ìƒì„± (`OrderEvent`)
- ê²°ì œ ì™„ë£Œ (`PaymentEvent`)
- í™˜ë¶ˆ ìš”ì²­ (`RefundEvent`)
- AI API ì˜¤ë¥˜ (OpenAI rate limit ë“±)

---

### 7. ELK Stack (ë¡œê¹… & ëª¨ë‹ˆí„°ë§)

**êµ¬ì„±**:
```
Application (Logback)
    â†“ (Logstash Encoder)
Logstash (í¬íŠ¸ 5044)
    â†“
Elasticsearch (í¬íŠ¸ 9200)
    â†“
Kibana (í¬íŠ¸ 5601)
```

**ë¡œê·¸ ì „ì†¡ ì„¤ì •** (`logback-spring.xml`):
```xml
<appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
    <destination>localhost:5044</destination>
    <encoder class="net.logstash.logback.encoder.LogstashEncoder">
        <customFields>{"app":"shopping-mall"}</customFields>
    </encoder>
</appender>
```

**ìˆ˜ì§‘ ë¡œê·¸**:
- HTTP ìš”ì²­/ì‘ë‹µ (Spring MVC)
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¡œê·¸ (Service ê³„ì¸µ)
- AI API í˜¸ì¶œ ë¡œê·¸ (OpenAI, Qdrant)
- ì—ëŸ¬ ë¡œê·¸ (Exception)

---

## AI ê¸°ëŠ¥ ì•„í‚¤í…ì²˜

### 1. AI ì±—ë´‡ (`ChatbotService`)

**ê¸°ëŠ¥**: ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•´ ì£¼ë¬¸ ë‚´ì—­ì„ ê¸°ë°˜ìœ¼ë¡œ ë§ì¶¤ ë‹µë³€ ì œê³µ

**ì•„í‚¤í…ì²˜**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User     â”‚ "ë‚´ ì£¼ë¬¸ ë‚´ì—­ ì•Œë ¤ì¤˜"
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚ POST /api/chatbot/chat
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ChatbotController              â”‚
â”‚  @AuthenticationPrincipal userId    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ChatbotService                â”‚
â”‚  1. ì£¼ë¬¸ ê´€ë ¨ í‚¤ì›Œë“œ ê°ì§€                â”‚
â”‚     (ì£¼ë¬¸|êµ¬ë§¤|ìƒ€|ì‚°|ë‚´ì—­|order)        â”‚
â”‚  2. userIdë¡œ ìµœê·¼ ì£¼ë¬¸ 10ê°œ ì¡°íšŒ        â”‚
â”‚  3. ì£¼ë¬¸ ì»¨í…ìŠ¤íŠ¸ ìƒì„±                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
       â”‚             â”‚
       â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserOrder  â”‚  â”‚   OpenAI     â”‚
â”‚  Service   â”‚  â”‚   ChatClient â”‚
â”‚  (DB ì¡°íšŒ)  â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ OpenAI Response   â”‚
              â”‚ "ìµœê·¼ ì£¼ë¬¸ì€..."     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì½”ë“œ íë¦„**:
```java
public ChatbotResponse chat(Long userId, ChatbotRequest request) {
    String question = request.question();
    String contextInfo = "";

    // 1. ì£¼ë¬¸ ê´€ë ¨ ì§ˆë¬¸ ê°ì§€
    if (isOrderInquiry(question)) {
        // 2. ì‚¬ìš©ì ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ (ìµœê·¼ 10ê°œ)
        contextInfo = getUserOrderContext(userId);
        // ì˜ˆ: "[ì‚¬ìš©ìì˜ ìµœê·¼ ì£¼ë¬¸ ë‚´ì—­]
        //      - ì£¼ë¬¸ë²ˆí˜¸: 123, ìƒí’ˆ: ë…¸íŠ¸ë¶, ê¸ˆì•¡: 1,500,000ì›, ìƒíƒœ: ë°°ì†¡ì¤‘"
    }

    // 3. OpenAIì— ì§ˆë¬¸ + ì»¨í…ìŠ¤íŠ¸ ì „ì†¡
    String answer = chatClient.prompt()
        .system(systemPrompt)  // FAQ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
        .user(contextInfo + "\n\nì‚¬ìš©ì ì§ˆë¬¸: " + question)
        .call()
        .content();

    return new ChatbotResponse(answer);
}
```

**ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸**:
- íŒŒì¼: `src/main/resources/prompts/chatbot-system-prompt.txt`
- ë‚´ìš©: ì‡¼í•‘ëª° FAQ (ì£¼ë¬¸/ë°°ì†¡/ë°˜í’ˆ/êµí™˜/ê²°ì œ/í¬ì¸íŠ¸ ë“± 146ì¤„)

---

### 2. AI ìƒí’ˆ ë¶„ì„ (`ProductService.create()`)

**ê¸°ëŠ¥**: ìƒí’ˆ ë“±ë¡ ì‹œ AIê°€ íƒ€ê²Ÿ ê³ ê°(ì„±ë³„/ì—°ë ¹) ë° ì¶”ì²œ ì´ìœ  ìë™ ë¶„ì„

**ì•„í‚¤í…ì²˜**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AdminProduct  â”‚ POST /admin/products
â”‚  Controller   â”‚ (name, description, price, images)
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ProductService.create()          â”‚
â”‚  1. S3ì— ì´ë¯¸ì§€ ì—…ë¡œë“œ                    â”‚
â”‚  2. AI ìƒí’ˆ ë¶„ì„ í˜¸ì¶œ                    â”‚
â”‚  3. Product + ProductAnalysis ì €ì¥     â”‚
â”‚  4. VectorStoreì— ì„ë² ë”© ì €ì¥            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OpenAI ChatCompletion API           â”‚
â”‚   í”„ë¡¬í”„íŠ¸: "ì´ ìƒí’ˆì˜ íƒ€ê²Ÿ ì„±ë³„,            â”‚
â”‚             ì—°ë ¹ëŒ€, ì¶”ì²œ ì´ìœ  ë¶„ì„"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ProductAnalysis ìƒì„±               â”‚
â”‚  â€¢ gender: "FEMALE"                   â”‚
â”‚  â€¢ ageTarget: "TWENTIES"              â”‚
â”‚  â€¢ reason: "20ëŒ€ ì—¬ì„±ì—ê²Œ ì¸ê¸°..."        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Product ì—”í‹°í‹° ì €ì¥ (MySQL)            â”‚
â”‚  @Embedded ProductAnalysis            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ProductAnalysis ì„ë² ë””ë“œ ì—”í‹°í‹°**:
```java
@Embeddable
public class ProductAnalysis {
    @Enumerated(EnumType.STRING)
    private Gender gender;        // MALE, FEMALE, UNISEX

    @Enumerated(EnumType.STRING)
    private AgeTarget ageTarget;  // TEENS, TWENTIES, THIRTIES, ...

    @Column(length = 500)
    private String reason;        // "20ëŒ€ ì—¬ì„±ì—ê²Œ ì¸ê¸° ìˆëŠ” íŠ¸ë Œë””í•œ ë””ìì¸"
}
```

---

### 3. AI ìƒí’ˆ ì¶”ì²œ (`ProductService.recommendProducts()`)

**ê¸°ëŠ¥**: ì‚¬ìš©ì ì§ˆë¬¸ì„ ë°”íƒ•ìœ¼ë¡œ ìœ ì‚¬ ìƒí’ˆ ì¶”ì²œ + AI ì¶”ì²œ ì´ìœ  ìƒì„±

**ì•„í‚¤í…ì²˜**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User     â”‚ "30ëŒ€ ë‚¨ì„±ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” ì˜· ì¶”ì²œí•´ì¤˜"
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚ POST /api/products/recommendations
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ProductService.recommendProducts()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1. OpenAI Embedding API í˜¸ì¶œ               â”‚
â”‚      "30ëŒ€ ë‚¨ì„± ì˜·" â†’ 1536ì°¨ì› ë²¡í„° ìƒì„±          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   2. Qdrant VectorStore ìœ ì‚¬ë„ ê²€ìƒ‰            â”‚
â”‚      searchSimilarDocuments(ë²¡í„°, top 10)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   3. ìœ ì‚¬ ìƒí’ˆ 10ê°œ ë°˜í™˜                        â”‚
â”‚      [Product 123, Product 456, ...]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   4. OpenAIë¡œ ì¶”ì²œ ì´ìœ  ìƒì„±                    â”‚
â”‚      "ì´ ìƒí’ˆë“¤ì„ ì¶”ì²œí•˜ëŠ” ì´ìœ ëŠ”..."              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RecommendationResponse ë°˜í™˜                â”‚
â”‚   {                                         â”‚
â”‚     "question": "30ëŒ€ ë‚¨ì„±...",              â”‚
â”‚     "products": [...],                      â”‚
â”‚     "aiRecommendation": "ì¶”ì²œ ì´ìœ ..."        â”‚
â”‚   }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë²¡í„° ì €ì¥ ì‹œì **:
```java
// ìƒí’ˆ ìƒì„± ì‹œ ìë™ìœ¼ë¡œ VectorStoreì— ì €ì¥
public void create(Long userId, ProductCommand.Create command) {
    // 1. ìƒí’ˆ ì €ì¥
    Product product = productRepository.save(...);

    // 2. ë²¡í„° ìƒì„± ë° ì €ì¥
    String content = product.getName() + " " + product.getDescription();
    Document document = new Document(String.valueOf(product.getId()), content, metadata);
    vectorStore.add(List.of(document));
}
```

---

### 4. ë¦¬ë·° AI ìš”ì•½ (`ReviewSummaryService`)

**ê¸°ëŠ¥**: ìƒí’ˆì˜ ìµœê·¼ 30ê°œ ë¦¬ë·°ë¥¼ ìš”ì•½í•˜ì—¬ í•œëˆˆì— íŒŒì•… ê°€ëŠ¥í•˜ê²Œ ì œê³µ

**ì•„í‚¤í…ì²˜**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User     â”‚ GET /api/reviews/summary?productId=123
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReviewSummaryService.getSummary()     â”‚
â”‚  1. Redis ìºì‹œ í™•ì¸                      â”‚
â”‚  2. ìºì‹œ ì—†ìœ¼ë©´ ìƒì„±                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReviewRepository.findRecent(30ê°œ)      â”‚
â”‚  ìµœê·¼ ë¦¬ë·° 30ê°œ ì¡°íšŒ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenAI ChatCompletion API             â”‚
â”‚  "ë‹¤ìŒ ë¦¬ë·°ë“¤ì„ 3ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•´ì¤˜"            â”‚
â”‚  [ë¦¬ë·°1, ë¦¬ë·°2, ..., ë¦¬ë·°30]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReviewSummary ìƒì„± ë° ì €ì¥ (MySQL)       â”‚
â”‚  â€¢ productId                           â”‚
â”‚  â€¢ summaryText: "ì „ë°˜ì ìœ¼ë¡œ ë§Œì¡±..."       â”‚
â”‚  â€¢ reviewCount: 30                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis ìºì‹œ ì €ì¥ (24ì‹œê°„ TTL)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìºì‹± ì „ëµ**:
```yaml
review-summary:
  max-reviews: 30    # ìš”ì•½ì— ì‚¬ìš©í•  ìµœê·¼ ë¦¬ë·° ê°œìˆ˜
  ttl-hours: 24      # ìš”ì•½ ìºì‹œ ìœ íš¨ì‹œê°„
```

---

## ê³„ì¸µ êµ¬ì¡°

### Layered Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Presentation Layer                    â”‚
â”‚                   (Controller ê³„ì¸µ)                     â”‚
â”‚  â€¢ ProductController  â€¢ OrderController                â”‚
â”‚  â€¢ ReviewController   â€¢ ChatbotController              â”‚
â”‚  â€¢ REST API ì—”ë“œí¬ì¸íŠ¸ ì œê³µ                                â”‚
â”‚  â€¢ ìš”ì²­ ê²€ì¦ (Validation)                                â”‚
â”‚  â€¢ ì‘ë‹µ í¬ë§·íŒ… (ApiResult<T>)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Service Layer                        â”‚
â”‚                 (Business Logic ê³„ì¸µ)                   â”‚
â”‚  â€¢ ProductService     â€¢ OrderService                   â”‚
â”‚  â€¢ ReviewService      â€¢ ChatbotService                 â”‚
â”‚  â€¢ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬                                      â”‚
â”‚  â€¢ íŠ¸ëœì­ì…˜ ê´€ë¦¬ (@Transactional)                         â”‚
â”‚  â€¢ ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰ (OrderEvent, PaymentEvent)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Domain Layer                          â”‚
â”‚                   (Domain ê³„ì¸µ)                         â”‚
â”‚  â€¢ Product        â€¢ Order        â€¢ Review              â”‚
â”‚  â€¢ ë„ë©”ì¸ ì—”í‹°í‹° (JPA Entity)                             â”‚
â”‚  â€¢ ë„ë©”ì¸ ë¡œì§ (ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™)                               â”‚
â”‚  â€¢ ë„ë©”ì¸ ì´ë²¤íŠ¸ (Event)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Repository Layer                         â”‚
â”‚              (Data Access ê³„ì¸µ)                         â”‚
â”‚  â€¢ ProductRepository  â€¢ OrderRepository                â”‚
â”‚  â€¢ Spring Data JPA (CRUD)                              â”‚
â”‚  â€¢ QueryDSL (ë™ì  ì¿¼ë¦¬)                                  â”‚
â”‚  â€¢ Custom Query (ë³µì¡í•œ ì¡°íšŒ)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Infrastructure Layer                      â”‚
â”‚                (ì™¸ë¶€ ì‹œìŠ¤í…œ í†µí•©)                          â”‚
â”‚  â€¢ RedisService   â€¢ AwsS3Service   â€¢ NotifyApi         â”‚
â”‚  â€¢ OpenAI API     â€¢ Qdrant         â€¢ Slack API         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë°ì´í„° íë¦„

### 1. ì£¼ë¬¸ ìƒì„± í”Œë¡œìš°

```
[Client]
  â”‚ POST /orders
  â”‚ { items, addressId, deliveryRequest, usePoints }
  â–¼
[OrderController]
  â”‚ ìš”ì²­ ê²€ì¦ (@Valid)
  â”‚ ì‚¬ìš©ì ì¸ì¦ (JWT)
  â–¼
[OrderService.create()]
  â”‚
  â”œâ”€â–º [StockService] ì¬ê³  ì°¨ê° (ë¶„ì‚° ë½)
  â”‚   â””â”€â–º Redis Lock íšë“
  â”‚       â””â”€â–º Product.decreaseStock()
  â”‚
  â”œâ”€â–º [PointService] í¬ì¸íŠ¸ ì‚¬ìš© (ë¶„ì‚° ë½)
  â”‚   â””â”€â–º Redis Lock íšë“
  â”‚       â””â”€â–º Point.use()
  â”‚
  â”œâ”€â–º [Order ìƒì„± ë° ì €ì¥]
  â”‚   â””â”€â–º OrderRepository.save()
  â”‚
  â””â”€â–º [ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰]
      â””â”€â–º OrderEvent(ì£¼ë¬¸ ID, ì‚¬ìš©ì ID)
          â””â”€â–º OrderEventListener
              â””â”€â–º Slack ì•Œë¦¼ ì „ì†¡
                  "ìƒˆ ì£¼ë¬¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤"
```

### 2. ìƒí’ˆ ì¡°íšŒ í”Œë¡œìš° (ì¡°íšŒìˆ˜ ì¦ê°€)

```
[Client]
  â”‚ GET /products/123
  â–¼
[ProductController.getProduct()]
  â”‚
  â–¼
[ProductService.getProduct()]
  â”‚
  â”œâ”€â–º [ProductRepository] ìƒí’ˆ ì¡°íšŒ
  â”‚   â””â”€â–º SELECT * FROM products WHERE id = 123
  â”‚
  â””â”€â–º [RedisService] ì¡°íšŒìˆ˜ ì¦ê°€
      â””â”€â–º HINCRBY product:view:count 123 1

[ViewSyncScheduler]
  â”‚ @Scheduled(ë§¤ì‹œê°„)
  â”‚
  â””â”€â–º Redis ì¡°íšŒìˆ˜ â†’ MySQL ë™ê¸°í™”
      â””â”€â–º UPDATE products SET view_count = ?
```

### 3. AI ì±—ë´‡ ì‘ë‹µ í”Œë¡œìš°

```
[Client]
  â”‚ POST /api/chatbot/chat
  â”‚ { "question": "ë‚´ ì£¼ë¬¸ ë‚´ì—­ ì•Œë ¤ì¤˜" }
  â–¼
[ChatbotController]
  â”‚ JWT ì¸ì¦ â†’ userId ì¶”ì¶œ
  â–¼
[ChatbotService.chat()]
  â”‚
  â”œâ”€â–º [1] ì£¼ë¬¸ ê´€ë ¨ í‚¤ì›Œë“œ ê°ì§€
  â”‚   â””â”€â–º Pattern.matches("ì£¼ë¬¸|êµ¬ë§¤|ìƒ€|ì‚°|ë‚´ì—­|order")
  â”‚       â””â”€â–º true
  â”‚
  â”œâ”€â–º [2] UserOrderService.listMyOrders()
  â”‚   â””â”€â–º SELECT * FROM orders WHERE user_id = ?
  â”‚       LIMIT 10
  â”‚   â””â”€â–º ì£¼ë¬¸ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
  â”‚       "[ì‚¬ìš©ìì˜ ìµœê·¼ ì£¼ë¬¸ ë‚´ì—­]
  â”‚        - ì£¼ë¬¸ë²ˆí˜¸: 123, ìƒí’ˆ: ë…¸íŠ¸ë¶, ê¸ˆì•¡: 1,500,000ì›"
  â”‚
  â””â”€â–º [3] OpenAI ChatClient
      â””â”€â–º System Prompt: FAQ í”„ë¡¬í”„íŠ¸
      â””â”€â–º User Prompt: ì£¼ë¬¸ ì»¨í…ìŠ¤íŠ¸ + "ë‚´ ì£¼ë¬¸ ë‚´ì—­ ì•Œë ¤ì¤˜"
      â””â”€â–º OpenAI API í˜¸ì¶œ
          â””â”€â–º Response: "ìµœê·¼ ì£¼ë¬¸ì€ ë…¸íŠ¸ë¶ 1ê°œì…ë‹ˆë‹¤..."
```

---

## ì£¼ìš” ê¸°ëŠ¥ë³„ ì•„í‚¤í…ì²˜

### 1. ìƒí’ˆ ê´€ë¦¬

**ì—”í‹°í‹° êµ¬ì¡°**:
```java
@Entity
public class Product extends BaseEntity {
    private String name;
    private Long price;
    private Long stock;
    private Long viewCount;
    private String description;
    private ProductStatus status;  // ACTIVATED, SOLD_OUT, IN_ACTIVATED, DELETED
    private String thumbnailImgUrl;
    private String detailImgUrl;

    @Embedded
    private ProductAnalysis productAnalysis;  // AI ë¶„ì„ ê²°ê³¼

    @OneToMany(mappedBy = "product")
    private List<OrderProduct> orderProducts;
}
```

**ìƒí’ˆ ìƒì„± íë¦„**:
1. ê´€ë¦¬ìê°€ ìƒí’ˆ ì •ë³´ + ì´ë¯¸ì§€ ì—…ë¡œë“œ
2. S3ì— ì´ë¯¸ì§€ ì €ì¥ â†’ URL ë°˜í™˜
3. OpenAIë¡œ ìƒí’ˆ ë¶„ì„ (ì„±ë³„/ì—°ë ¹/ì´ìœ )
4. Product + ProductAnalysis ì €ì¥
5. Qdrant VectorStoreì— ì„ë² ë”© ì €ì¥

---

### 2. ì£¼ë¬¸/ê²°ì œ ê´€ë¦¬

**ì£¼ë¬¸ ìƒíƒœ ì „ì´**:
```
ORDER_CREATED (ì£¼ë¬¸ ìƒì„±)
    â†“ ê´€ë¦¬ì ìŠ¹ì¸
ORDER_ACCEPTED (ì£¼ë¬¸ ìŠ¹ì¸)
    â†“ ë°°ì†¡ ì‹œì‘
ORDER_PREPARING (ì£¼ë¬¸ ì¤€ë¹„ì¤‘)
    â†“ ë°°ì†¡ ì¶œë°œ
ORDER_SHIPPING (ë°°ì†¡ì¤‘)
    â†“ ë°°ì†¡ ì™„ë£Œ
ORDER_DELIVERED (ë°°ì†¡ ì™„ë£Œ)

ORDER_CANCELLED (ì£¼ë¬¸ ì·¨ì†Œ) â† ì‚¬ìš©ì/ê´€ë¦¬ì ì·¨ì†Œ
```

**ë™ì‹œì„± ì œì–´**:
```java
// ì¬ê³  ì°¨ê° ì‹œ ë¶„ì‚° ë½ ì‚¬ìš©
@Lock(key = "#productId", leaseTime = 3000L)
public void decreaseStock(Long productId, Long quantity) {
    Product product = productRepository.findById(productId)
        .orElseThrow();

    if (!product.canProvide(quantity)) {
        throw new CustomException(ErrorCode.OUT_OF_STOCK);
    }

    product.decreaseStock(quantity);
}
```

---

### 3. ë¦¬ë·° ì‹œìŠ¤í…œ

**ë¦¬ë·° ì—”í‹°í‹°**:
```java
@Entity
public class Review extends BaseEntity {
    @ManyToOne
    private User user;

    @ManyToOne
    private Product product;

    private Integer rating;       // 1~5ì 
    private String content;       // ë¦¬ë·° ë‚´ìš©
    private String imageUrl;      // ë¦¬ë·° ì´ë¯¸ì§€ (S3)
    private Long viewCount;       // ì¡°íšŒìˆ˜ (Redis ìºì‹±)
    private Boolean isBlinded;    // ë¸”ë¼ì¸ë“œ ì²˜ë¦¬ ì—¬ë¶€
}
```

**ë¦¬ë·° AI ìš”ì•½**:
- ìƒí’ˆë³„ ìµœê·¼ 30ê°œ ë¦¬ë·° ìš”ì•½
- Redis ìºì‹± (24ì‹œê°„)
- `ReviewSummary` ì—”í‹°í‹°ì— ì €ì¥

---

### 4. í¬ì¸íŠ¸ ì‹œìŠ¤í…œ

**í¬ì¸íŠ¸ ì´ë²¤íŠ¸ ê¸°ë°˜ ì ë¦½**:
```java
@EventListener
public void handleOrderDelivered(OrderEvent event) {
    if (event.status() == OrderStatus.ORDER_DELIVERED) {
        // ë°°ì†¡ ì™„ë£Œ í›„ 7ì¼ í›„ í¬ì¸íŠ¸ ì ë¦½
        pointService.earnPoints(event.userId(), event.totalPrice() * 0.01);
    }
}
```

**í¬ì¸íŠ¸ ì´ë ¥ ì¶”ì **:
```java
@Entity
public class PointHistory {
    @ManyToOne
    private Point point;

    private Long amount;          // ì ë¦½/ì‚¬ìš© ê¸ˆì•¡
    private PointHistoryType type; // EARNED, USED, EXPIRED
    private String description;    // "ìƒí’ˆ êµ¬ë§¤ ì ë¦½", "ì£¼ë¬¸ ì‚¬ìš©"
}
```

---

## ë³´ì•ˆ ì•„í‚¤í…ì²˜

### JWT ì¸ì¦

```
[Client Login]
  â”‚ POST /auth/login
  â”‚ { username, password }
  â–¼
[AuthService]
  â”‚ ì‚¬ìš©ì ê²€ì¦
  â”‚ BCrypt ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
  â–¼
[JwtService.generateToken()]
  â”‚ Access Token ìƒì„± (5ë¶„)
  â”‚ Refresh Token ìƒì„± (12ì‹œê°„)
  â”‚
  â””â”€â–º { accessToken, refreshToken }

[Client Request with Token]
  â”‚ GET /products
  â”‚ Authorization: Bearer {accessToken}
  â–¼
[JwtFilter]
  â”‚ í† í° ê²€ì¦
  â”‚ JWT íŒŒì‹±
  â”‚ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
  â”‚
  â””â”€â–º SecurityContextì— ì¸ì¦ ì •ë³´ ì €ì¥
      â””â”€â–º @AuthenticationPrincipalë¡œ ì£¼ì…
```

### ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC)

```java
@PreAuthorize("hasRole('ADMIN')")
public void createProduct() { ... }

@PreAuthorize("hasRole('SUPER_ADMIN')")
public void grantAdminRole() { ... }
```

---

## ëª¨ë‹ˆí„°ë§ & ë¡œê¹…

### ë¡œê¹… ë ˆë²¨ ì „ëµ

```yaml
logging:
  level:
    root: INFO
    com.kt.controller: WARN
    com.kt.service: INFO
    org.hibernate.SQL: OFF  # ìš´ì˜: OFF, ë¡œì»¬: DEBUG
```

### ì£¼ìš” ë¡œê·¸ ì´ë²¤íŠ¸

1. **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œê·¸**:
   - ìƒí’ˆ ìƒì„± (userId, productId, name)
   - ì£¼ë¬¸ ìƒì„± (userId, orderId, totalPrice)
   - ê²°ì œ ì™„ë£Œ (paymentId, amount)

2. **AI ë¡œê·¸**:
   - OpenAI API í˜¸ì¶œ (ìš”ì²­/ì‘ë‹µ ê¸¸ì´, ì†Œìš” ì‹œê°„)
   - VectorStore ê²€ìƒ‰ (ê²€ìƒ‰ì–´, ê²°ê³¼ ê°œìˆ˜)

3. **ì—ëŸ¬ ë¡œê·¸**:
   - ì˜ˆì™¸ ë°œìƒ (StackTrace)
   - API ì˜¤ë¥˜ (HTTP ìƒíƒœ ì½”ë“œ)

---

## ì„±ëŠ¥ ìµœì í™”

### 1. ìºì‹± ì „ëµ

```
ì¡°íšŒìˆ˜: Redis (HINCRBY) â†’ ë§¤ì‹œê°„ MySQL ë™ê¸°í™”
ë¦¬ë·° ìš”ì•½: Redis (24ì‹œê°„ TTL)
ìƒí’ˆ ëª©ë¡: JPA 2ì°¨ ìºì‹œ ê³ ë ¤ (í–¥í›„)
```

### 2. N+1 ë¬¸ì œ í•´ê²°

```java
// Fetch Join ì‚¬ìš©
@Query("SELECT o FROM Order o JOIN FETCH o.orderProducts WHERE o.user.id = :userId")
Page<Order> findByUserIdWithProducts(Long userId, Pageable pageable);
```

### 3. ì¸ë±ìŠ¤ ì „ëµ

```sql
-- ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤
CREATE INDEX idx_product_status ON products(status);
CREATE INDEX idx_order_user_id ON orders(user_id);
CREATE INDEX idx_review_product_id ON reviews(product_id);
```

---

## ë°°í¬ ì•„í‚¤í…ì²˜

### AWS Elastic Beanstalk

```
[GitHub Actions]
  â”‚ Push to main
  â”‚
  â–¼
[CI/CD Pipeline]
  â”‚ ./gradlew clean build
  â”‚ ./gradlew bootJar
  â”‚ ./gradlew zip
  â”‚
  â””â”€â–º shopping.zip
      â”œâ”€â”€ shopping.jar
      â””â”€â”€ Procfile (web: java -jar shopping.jar)

  â–¼
[AWS Elastic Beanstalk]
  â”‚ Java 21 (Amazon Corretto)
  â”‚ t3.small (2vCPU, 2GB RAM)
  â”‚
  â””â”€â–º EC2 Instance
      â””â”€â–º Application Running (í¬íŠ¸ 8080)
```

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# Elastic Beanstalk Environment Properties
OPENAI_API_KEY=sk-proj-...
AWS_ACCESS_KEY=AKIA...
AWS_SECRET_KEY=...
SLACK_API_TOKEN=xoxb-...
SLACK_LOG_CHANNEL=C...
db.host=mysql-endpoint.rds.amazonaws.com
redis.host=redis-endpoint.cache.amazonaws.com
```

---

## í–¥í›„ ê°œì„  ë°©í–¥

### 1. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì „í™˜
- User Service, Admin Service ë¶„ë¦¬
- API Gateway ë„ì…
- Service Mesh (Istio)

### 2. AI ê¸°ëŠ¥ í™•ì¥
- ìƒí’ˆ ìë™ íƒœê¹…
- ë¦¬ë·° ê°ì • ë¶„ì„
- ê°œì¸í™” ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ ê³ ë„í™”

### 3. ì„±ëŠ¥ ìµœì í™”
- CDN ë„ì… (CloudFront)
- Read Replica (MySQL)
- ElastiCache (Redis)

---

**ë¬¸ì„œ ì‘ì„±ì¼**: 2026-01-07
**ë²„ì „**: 1.0
